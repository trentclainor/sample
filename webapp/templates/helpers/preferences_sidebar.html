{%- macro sidebar_link(label, endpoint) -%}
    {% set re = request.endpoint[:request.endpoint.find('.', request.endpoint.find('.') + 1)] %}
    <li{% if endpoint[:endpoint.find('.', endpoint.find('.') + 1)] == re or endpoint == re %} class="active"{% endif %}><a href="{{ url_for(endpoint, **kwargs) }}">{{ label }}</a></li>
{%- endmacro -%}

{% macro sidebar() %}
{% if current_user.is_admin() %}
{%
    set menu = (_('Основные'), [
                    (_('Администраторы'), 'preferences.managers'),
                ]),
                ('', [],),
                (_('Системные'), [
                    (_('Шаблоны'), 'preferences.code_templates'),
                    (_('Параметры'), 'preferences.parameters'),
                ])
%}
{% else %}
{%
    set menu = (_('Системные'), [
                    (_('Шаблоны'), 'preferences.code_templates'),
                    (_('Параметры'), 'preferences.parameters'),
                ])
%}
{% endif %}
    <div class="col-md-2 sidebar">
        <ul class="nav nav-pills nav-stacked">
            {% for header, subitem in menu %}
            {% if header != '' %}
        </ul>
        <ul class="nav nav-pills nav-stacked">
            <li><h5>{{ header }}</h5></li>
            {% else%}
            <li class="divider"></li>
            {% endif %}
            {% for label, endpoint in subitem %}
                {{ sidebar_link(label, endpoint) }}
            {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endmacro %}